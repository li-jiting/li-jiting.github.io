{"title":"用户消费分析","uid":"3d9d038cb0872dd03dea32d865f59a41","slug":"用户消费","date":"2023-09-09T04:17:53.000Z","updated":"2023-09-14T14:07:04.653Z","comments":true,"path":"api/articles/用户消费.json","keywords":null,"cover":[],"content":"<h1 id=\"用户消费分析\"><a href=\"#用户消费分析\" class=\"headerlink\" title=\"用户消费分析\"></a>用户消费分析</h1><pre class=\"line-numbers language-python\" data-language=\"python\"><code class=\"language-python\">import numpy as np\nimport pandas as pd\nfrom pandas import DataFrame,Series\nimport matplotlib.pyplot as plt\n#CDNOW_master.txt</code></pre>\n\n\n<h3 id=\"第一部分：数据类型处理\"><a href=\"#第一部分：数据类型处理\" class=\"headerlink\" title=\"第一部分：数据类型处理\"></a>第一部分：数据类型处理</h3><ul>\n<li>数据加载<ul>\n<li>字段含义：<ul>\n<li>user_id:用户ID</li>\n<li>order_dt:购买日期</li>\n<li>order_product:购买产品的数量</li>\n<li>order_amount:购买金额</li>\n</ul>\n</li>\n</ul>\n</li>\n<li>观察数据<ul>\n<li>查看数据的数据类型</li>\n<li>数据中是否存储在缺失值</li>\n<li>将order_dt转换成时间类型</li>\n<li>查看数据的统计描述<ul>\n<li>计算所有用户购买商品的平均数量</li>\n<li>计算所有用户购买商品的平均花费</li>\n</ul>\n</li>\n<li>在源数据中添加一列表示月份:astype(‘datetime64[M]’)</li>\n</ul>\n</li>\n</ul>\n<pre class=\"line-numbers language-python\" data-language=\"python\"><code class=\"language-python\">#数据的加载\ndf &#x3D; pd.read_csv(&#39;.&#x2F;data&#x2F;CDNOW_master.txt&#39;,header&#x3D;None,sep&#x3D;&#39;\\s+&#39;,names&#x3D;[&#39;user_id&#39;,&#39;order_dt&#39;,&#39;order_product&#39;,&#39;order_amount&#39;])\ndf</code></pre>\n\n\n\n\n<div>\n<style scoped>\n    .dataframe tbody tr th:only-of-type {\n        vertical-align: middle;\n    }\n\n<pre><code>.dataframe tbody tr th &#123;\n    vertical-align: top;\n&#125;\n\n.dataframe thead th &#123;\n    text-align: right;\n&#125;\n</code></pre>\n<p></style></p>\n<table border=\"1\" class=\"dataframe\">\n  <thead>\n    <tr style=\"text-align: right;\">\n      <th></th>\n      <th>user_id</th>\n      <th>order_dt</th>\n      <th>order_product</th>\n      <th>order_amount</th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <th>0</th>\n      <td>1</td>\n      <td>19970101</td>\n      <td>1</td>\n      <td>11.77</td>\n    </tr>\n    <tr>\n      <th>1</th>\n      <td>2</td>\n      <td>19970112</td>\n      <td>1</td>\n      <td>12.00</td>\n    </tr>\n    <tr>\n      <th>2</th>\n      <td>2</td>\n      <td>19970112</td>\n      <td>5</td>\n      <td>77.00</td>\n    </tr>\n    <tr>\n      <th>3</th>\n      <td>3</td>\n      <td>19970102</td>\n      <td>2</td>\n      <td>20.76</td>\n    </tr>\n    <tr>\n      <th>4</th>\n      <td>3</td>\n      <td>19970330</td>\n      <td>2</td>\n      <td>20.76</td>\n    </tr>\n    <tr>\n      <th>...</th>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n    </tr>\n    <tr>\n      <th>69654</th>\n      <td>23568</td>\n      <td>19970405</td>\n      <td>4</td>\n      <td>83.74</td>\n    </tr>\n    <tr>\n      <th>69655</th>\n      <td>23568</td>\n      <td>19970422</td>\n      <td>1</td>\n      <td>14.99</td>\n    </tr>\n    <tr>\n      <th>69656</th>\n      <td>23569</td>\n      <td>19970325</td>\n      <td>2</td>\n      <td>25.74</td>\n    </tr>\n    <tr>\n      <th>69657</th>\n      <td>23570</td>\n      <td>19970325</td>\n      <td>3</td>\n      <td>51.12</td>\n    </tr>\n    <tr>\n      <th>69658</th>\n      <td>23570</td>\n      <td>19970326</td>\n      <td>2</td>\n      <td>42.96</td>\n    </tr>\n  </tbody>\n</table>\n<p>69659 rows × 4 columns</p>\n</div>\n\n\n\n\n<pre class=\"line-numbers language-python\" data-language=\"python\"><code class=\"language-python\">df.info()</code></pre>\n\n<pre><code>&lt;class &#39;pandas.core.frame.DataFrame&#39;&gt;\nRangeIndex: 69659 entries, 0 to 69658\nData columns (total 4 columns):\n #   Column         Non-Null Count  Dtype  \n---  ------         --------------  -----  \n 0   user_id        69659 non-null  int64  \n 1   order_dt       69659 non-null  int64  \n 2   order_product  69659 non-null  int64  \n 3   order_amount   69659 non-null  float64\ndtypes: float64(1), int64(3)\nmemory usage: 2.1 MB\n</code></pre>\n<pre class=\"line-numbers language-python\" data-language=\"python\"><code class=\"language-python\">#将order_dt转换成时间类型\ndf[&#39;order_dt&#39;] &#x3D; pd.to_datetime(df[&#39;order_dt&#39;],format&#x3D;&#39;%Y%m%d&#39;)</code></pre>\n\n\n<pre class=\"line-numbers language-python\" data-language=\"python\"><code class=\"language-python\">df</code></pre>\n\n\n\n\n<div>\n<style scoped>\n    .dataframe tbody tr th:only-of-type {\n        vertical-align: middle;\n    }\n\n<pre><code>.dataframe tbody tr th &#123;\n    vertical-align: top;\n&#125;\n\n.dataframe thead th &#123;\n    text-align: right;\n&#125;\n</code></pre>\n<p></style></p>\n<table border=\"1\" class=\"dataframe\">\n  <thead>\n    <tr style=\"text-align: right;\">\n      <th></th>\n      <th>user_id</th>\n      <th>order_dt</th>\n      <th>order_product</th>\n      <th>order_amount</th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <th>0</th>\n      <td>1</td>\n      <td>1997-01-01</td>\n      <td>1</td>\n      <td>11.77</td>\n    </tr>\n    <tr>\n      <th>1</th>\n      <td>2</td>\n      <td>1997-01-12</td>\n      <td>1</td>\n      <td>12.00</td>\n    </tr>\n    <tr>\n      <th>2</th>\n      <td>2</td>\n      <td>1997-01-12</td>\n      <td>5</td>\n      <td>77.00</td>\n    </tr>\n    <tr>\n      <th>3</th>\n      <td>3</td>\n      <td>1997-01-02</td>\n      <td>2</td>\n      <td>20.76</td>\n    </tr>\n    <tr>\n      <th>4</th>\n      <td>3</td>\n      <td>1997-03-30</td>\n      <td>2</td>\n      <td>20.76</td>\n    </tr>\n    <tr>\n      <th>...</th>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n    </tr>\n    <tr>\n      <th>69654</th>\n      <td>23568</td>\n      <td>1997-04-05</td>\n      <td>4</td>\n      <td>83.74</td>\n    </tr>\n    <tr>\n      <th>69655</th>\n      <td>23568</td>\n      <td>1997-04-22</td>\n      <td>1</td>\n      <td>14.99</td>\n    </tr>\n    <tr>\n      <th>69656</th>\n      <td>23569</td>\n      <td>1997-03-25</td>\n      <td>2</td>\n      <td>25.74</td>\n    </tr>\n    <tr>\n      <th>69657</th>\n      <td>23570</td>\n      <td>1997-03-25</td>\n      <td>3</td>\n      <td>51.12</td>\n    </tr>\n    <tr>\n      <th>69658</th>\n      <td>23570</td>\n      <td>1997-03-26</td>\n      <td>2</td>\n      <td>42.96</td>\n    </tr>\n  </tbody>\n</table>\n<p>69659 rows × 4 columns</p>\n</div>\n\n\n\n\n<pre class=\"line-numbers language-python\" data-language=\"python\"><code class=\"language-python\">df.info()</code></pre>\n\n<pre><code>&lt;class &#39;pandas.core.frame.DataFrame&#39;&gt;\nRangeIndex: 69659 entries, 0 to 69658\nData columns (total 4 columns):\n #   Column         Non-Null Count  Dtype         \n---  ------         --------------  -----         \n 0   user_id        69659 non-null  int64         \n 1   order_dt       69659 non-null  datetime64[ns]\n 2   order_product  69659 non-null  int64         \n 3   order_amount   69659 non-null  float64       \ndtypes: datetime64[ns](1), float64(1), int64(2)\nmemory usage: 2.1 MB\n</code></pre>\n<pre class=\"line-numbers language-python\" data-language=\"python\"><code class=\"language-python\">#查看数据的统计描述\ndf.describe()</code></pre>\n\n\n\n\n<div>\n<style scoped>\n    .dataframe tbody tr th:only-of-type {\n        vertical-align: middle;\n    }\n\n<pre><code>.dataframe tbody tr th &#123;\n    vertical-align: top;\n&#125;\n\n.dataframe thead th &#123;\n    text-align: right;\n&#125;\n</code></pre>\n<p></style></p>\n<table border=\"1\" class=\"dataframe\">\n  <thead>\n    <tr style=\"text-align: right;\">\n      <th></th>\n      <th>user_id</th>\n      <th>order_product</th>\n      <th>order_amount</th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <th>count</th>\n      <td>69659.000000</td>\n      <td>69659.000000</td>\n      <td>69659.000000</td>\n    </tr>\n    <tr>\n      <th>mean</th>\n      <td>11470.854592</td>\n      <td>2.410040</td>\n      <td>35.893648</td>\n    </tr>\n    <tr>\n      <th>std</th>\n      <td>6819.904848</td>\n      <td>2.333924</td>\n      <td>36.281942</td>\n    </tr>\n    <tr>\n      <th>min</th>\n      <td>1.000000</td>\n      <td>1.000000</td>\n      <td>0.000000</td>\n    </tr>\n    <tr>\n      <th>25%</th>\n      <td>5506.000000</td>\n      <td>1.000000</td>\n      <td>14.490000</td>\n    </tr>\n    <tr>\n      <th>50%</th>\n      <td>11410.000000</td>\n      <td>2.000000</td>\n      <td>25.980000</td>\n    </tr>\n    <tr>\n      <th>75%</th>\n      <td>17273.000000</td>\n      <td>3.000000</td>\n      <td>43.700000</td>\n    </tr>\n    <tr>\n      <th>max</th>\n      <td>23570.000000</td>\n      <td>99.000000</td>\n      <td>1286.010000</td>\n    </tr>\n  </tbody>\n</table>\n</div>\n\n\n\n\n<pre class=\"line-numbers language-python\" data-language=\"python\"><code class=\"language-python\">#基于order_dt取出其中的月份\ndf[&#39;order_dt&#39;].astype(&#39;datetime64[M]&#39;)</code></pre>\n\n\n\n\n<pre><code>0       1997-01-01\n1       1997-01-12\n2       1997-01-12\n3       1997-01-02\n4       1997-03-30\n           ...    \n69654   1997-04-05\n69655   1997-04-22\n69656   1997-03-25\n69657   1997-03-25\n69658   1997-03-26\nName: order_dt, Length: 69659, dtype: datetime64[ns]\n</code></pre>\n<pre class=\"line-numbers language-python\" data-language=\"python\"><code class=\"language-python\">#在源数据中添加一列表示月份:astype(&#39;datetime64[M]&#39;)\ndf[&#39;month&#39;] &#x3D; df[&#39;order_dt&#39;].astype(&#39;datetime64[M]&#39;)</code></pre>\n\n\n<pre class=\"line-numbers language-python\" data-language=\"python\"><code class=\"language-python\">df</code></pre>\n\n\n\n\n<div>\n<style scoped>\n    .dataframe tbody tr th:only-of-type {\n        vertical-align: middle;\n    }\n\n<pre><code>.dataframe tbody tr th &#123;\n    vertical-align: top;\n&#125;\n\n.dataframe thead th &#123;\n    text-align: right;\n&#125;\n</code></pre>\n<p></style></p>\n<table border=\"1\" class=\"dataframe\">\n  <thead>\n    <tr style=\"text-align: right;\">\n      <th></th>\n      <th>user_id</th>\n      <th>order_dt</th>\n      <th>order_product</th>\n      <th>order_amount</th>\n      <th>month</th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <th>0</th>\n      <td>1</td>\n      <td>1997-01-01</td>\n      <td>1</td>\n      <td>11.77</td>\n      <td>1997-01-01</td>\n    </tr>\n    <tr>\n      <th>1</th>\n      <td>2</td>\n      <td>1997-01-12</td>\n      <td>1</td>\n      <td>12.00</td>\n      <td>1997-01-12</td>\n    </tr>\n    <tr>\n      <th>2</th>\n      <td>2</td>\n      <td>1997-01-12</td>\n      <td>5</td>\n      <td>77.00</td>\n      <td>1997-01-12</td>\n    </tr>\n    <tr>\n      <th>3</th>\n      <td>3</td>\n      <td>1997-01-02</td>\n      <td>2</td>\n      <td>20.76</td>\n      <td>1997-01-02</td>\n    </tr>\n    <tr>\n      <th>4</th>\n      <td>3</td>\n      <td>1997-03-30</td>\n      <td>2</td>\n      <td>20.76</td>\n      <td>1997-03-30</td>\n    </tr>\n    <tr>\n      <th>...</th>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n    </tr>\n    <tr>\n      <th>69654</th>\n      <td>23568</td>\n      <td>1997-04-05</td>\n      <td>4</td>\n      <td>83.74</td>\n      <td>1997-04-05</td>\n    </tr>\n    <tr>\n      <th>69655</th>\n      <td>23568</td>\n      <td>1997-04-22</td>\n      <td>1</td>\n      <td>14.99</td>\n      <td>1997-04-22</td>\n    </tr>\n    <tr>\n      <th>69656</th>\n      <td>23569</td>\n      <td>1997-03-25</td>\n      <td>2</td>\n      <td>25.74</td>\n      <td>1997-03-25</td>\n    </tr>\n    <tr>\n      <th>69657</th>\n      <td>23570</td>\n      <td>1997-03-25</td>\n      <td>3</td>\n      <td>51.12</td>\n      <td>1997-03-25</td>\n    </tr>\n    <tr>\n      <th>69658</th>\n      <td>23570</td>\n      <td>1997-03-26</td>\n      <td>2</td>\n      <td>42.96</td>\n      <td>1997-03-26</td>\n    </tr>\n  </tbody>\n</table>\n<p>69659 rows × 5 columns</p>\n</div>\n\n\n\n\n<pre class=\"line-numbers language-python\" data-language=\"python\"><code class=\"language-python\">df.info()</code></pre>\n\n<pre><code>&lt;class &#39;pandas.core.frame.DataFrame&#39;&gt;\nRangeIndex: 69659 entries, 0 to 69658\nData columns (total 5 columns):\n #   Column         Non-Null Count  Dtype         \n---  ------         --------------  -----         \n 0   user_id        69659 non-null  int64         \n 1   order_dt       69659 non-null  datetime64[ns]\n 2   order_product  69659 non-null  int64         \n 3   order_amount   69659 non-null  float64       \n 4   month          69659 non-null  datetime64[ns]\ndtypes: datetime64[ns](2), float64(1), int64(2)\nmemory usage: 2.7 MB\n</code></pre>\n<h3 id=\"第二部分：按月数据分析\"><a href=\"#第二部分：按月数据分析\" class=\"headerlink\" title=\"第二部分：按月数据分析\"></a>第二部分：按月数据分析</h3><ul>\n<li>用户每月花费的总金额<ul>\n<li>绘制曲线图展示</li>\n</ul>\n</li>\n<li>所有用户每月的产品购买量</li>\n<li>所有用户每月的消费总次数</li>\n<li>统计每月的消费人数</li>\n</ul>\n<pre class=\"line-numbers language-python\" data-language=\"python\"><code class=\"language-python\">#用户每月花费的总金额\ndf.groupby(by&#x3D;&#39;month&#39;)[&#39;order_amount&#39;].sum()</code></pre>\n\n\n<pre><code>month\n1997-01-01    7515.35\n1997-01-02    8025.95\n1997-01-03    7475.04\n1997-01-04    6722.93\n1997-01-05    9274.80\n               ...   \n1998-06-26    1646.63\n1998-06-27    2985.14\n1998-06-28    1388.44\n1998-06-29    2003.36\n1998-06-30    2180.65\nName: order_amount, Length: 546, dtype: float64\n</code></pre>\n<pre class=\"line-numbers language-python\" data-language=\"python\"><code class=\"language-python\"># plt.plot(df.groupby(by&#x3D;&#39;month&#39;)[&#39;order_amount&#39;].sum())\ndf.groupby(by&#x3D;&#39;month&#39;)[&#39;order_amount&#39;].sum().plot()</code></pre>\n\n\n<pre><code>&lt;Axes: xlabel=&#39;month&#39;&gt;\n</code></pre>\n<p><img src=\"/./assets/%E7%AC%94%E8%AE%B0_14_1.png\" alt=\"笔记_14_1\"></p>\n<pre class=\"line-numbers language-python\" data-language=\"python\"><code class=\"language-python\">#所有用户每月的产品购买量\ndf.groupby(by&#x3D;&#39;month&#39;)[&#39;order_product&#39;].sum().plot()</code></pre>\n\n\n\n\n<pre><code>&lt;matplotlib.axes._subplots.AxesSubplot at 0x1115d2978&gt;\n</code></pre>\n<p>​    <img src=\"/./assets/%E7%AC%94%E8%AE%B0_15_1.png\" alt=\"笔记_15_1\"></p>\n<pre class=\"line-numbers language-python\" data-language=\"python\"><code class=\"language-python\">#所有用户每月的消费总次数(原始数据中的一行数据表示一次消费记录)\ndf.groupby(by&#x3D;&#39;month&#39;)[&#39;user_id&#39;].count()</code></pre>\n\n\n<pre><code>month\n1997-01-01     8928\n1997-02-01    11272\n1997-03-01    11598\n1997-04-01     3781\n1997-05-01     2895\n1997-06-01     3054\n1997-07-01     2942\n1997-08-01     2320\n1997-09-01     2296\n1997-10-01     2562\n1997-11-01     2750\n1997-12-01     2504\n1998-01-01     2032\n1998-02-01     2026\n1998-03-01     2793\n1998-04-01     1878\n1998-05-01     1985\n1998-06-01     2043\nName: user_id, dtype: int64\n</code></pre>\n<pre class=\"line-numbers language-python\" data-language=\"python\"><code class=\"language-python\">#统计每月的消费人数(可能同一天一个用户会消费多次) nunique表示统计去重后的个数\ndf.groupby(by&#x3D;&#39;month&#39;)[&#39;user_id&#39;].nunique()</code></pre>\n\n\n\n\n<pre><code>month\n1997-01-01    7846\n1997-02-01    9633\n1997-03-01    9524\n1997-04-01    2822\n1997-05-01    2214\n1997-06-01    2339\n1997-07-01    2180\n1997-08-01    1772\n1997-09-01    1739\n1997-10-01    1839\n1997-11-01    2028\n1997-12-01    1864\n1998-01-01    1537\n1998-02-01    1551\n1998-03-01    2060\n1998-04-01    1437\n1998-05-01    1488\n1998-06-01    1506\nName: user_id, dtype: int64\n</code></pre>\n<h3 id=\"第三部分：用户个体消费数据分析\"><a href=\"#第三部分：用户个体消费数据分析\" class=\"headerlink\" title=\"第三部分：用户个体消费数据分析\"></a>第三部分：用户个体消费数据分析</h3><ul>\n<li>用户消费总金额和消费总次数的统计描述</li>\n<li>用户消费金额和消费产品数量的散点图</li>\n<li>各个用户消费总金额的直方分布图(消费金额在1000之内的分布)</li>\n<li>各个用户消费的总数量的直方分布图(消费商品的数量在100次之内的分布)</li>\n</ul>\n<pre class=\"line-numbers language-python\" data-language=\"python\"><code class=\"language-python\">#用户消费总金额和消费总次数的统计描述\ndf.groupby(by&#x3D;&#39;user_id&#39;)[&#39;order_amount&#39;].sum() #每一个用户消费的总金额</code></pre>\n\n\n\n\n<pre><code>user_id\n1         11.77\n2         89.00\n3        156.46\n4        100.50\n5        385.61\n6         20.99\n7        264.67\n8        197.66\n9         95.85\n10        39.31\n11        58.55\n12        57.06\n13        72.94\n14        29.92\n15        52.87\n16        79.87\n17        73.22\n18        14.96\n19       175.12\n20       653.01\n21        75.11\n22        14.37\n23        24.74\n24        57.77\n25       137.53\n26       102.69\n27       135.87\n28        90.99\n29       435.81\n30        28.34\n          ...  \n23541     57.34\n23542     77.43\n23543     50.76\n23544    134.63\n23545     24.99\n23546     13.97\n23547     23.54\n23548     23.54\n23549     27.13\n23550     25.28\n23551    264.63\n23552     49.38\n23553     98.58\n23554     36.37\n23555    189.18\n23556    203.00\n23557     14.37\n23558    145.60\n23559    111.65\n23560     18.36\n23561     83.46\n23562     29.33\n23563     58.75\n23564     70.01\n23565     11.77\n23566     36.00\n23567     20.97\n23568    121.70\n23569     25.74\n23570     94.08\nName: order_amount, Length: 23570, dtype: float64\n</code></pre>\n<pre class=\"line-numbers language-python\" data-language=\"python\"><code class=\"language-python\">#每一个用户消费的总次数\ndf.groupby(by&#x3D;&#39;user_id&#39;).count()[&#39;order_dt&#39;]</code></pre>\n\n\n\n\n<pre><code>user_id\n1         1\n2         2\n3         6\n4         4\n5        11\n6         1\n7         3\n8         8\n9         3\n10        1\n11        4\n12        1\n13        1\n14        1\n15        1\n16        4\n17        1\n18        1\n19        2\n20        2\n21        2\n22        1\n23        1\n24        2\n25        8\n26        2\n27        2\n28        3\n29       12\n30        2\n         ..\n23541     2\n23542     1\n23543     1\n23544     3\n23545     1\n23546     1\n23547     2\n23548     1\n23549     1\n23550     1\n23551     6\n23552     2\n23553     2\n23554     2\n23555     5\n23556     7\n23557     1\n23558     4\n23559     3\n23560     1\n23561     3\n23562     1\n23563     2\n23564     3\n23565     1\n23566     1\n23567     1\n23568     3\n23569     1\n23570     2\nName: order_dt, Length: 23570, dtype: int64\n</code></pre>\n<pre class=\"line-numbers language-python\" data-language=\"python\"><code class=\"language-python\">#用户消费金额和消费产品数量的散点图\nuser_amount_sum &#x3D; df.groupby(by&#x3D;&#39;user_id&#39;)[&#39;order_amount&#39;].sum()\nuser_product_sum &#x3D; df.groupby(by&#x3D;&#39;user_id&#39;)[&#39;order_product&#39;].sum()\nplt.scatter(user_product_sum,user_amount_sum)</code></pre>\n\n\n\n\n<pre><code>&lt;matplotlib.collections.PathCollection at 0x112253588&gt;\n​\n</code></pre>\n<p><img src=\"/./assets/%E7%AC%94%E8%AE%B0_21_1.png\" alt=\"笔记_21_1\"></p>\n<pre class=\"line-numbers language-python\" data-language=\"python\"><code class=\"language-python\">#各个用户消费总金额的直方分布图(消费金额在1000之内的分布)\ndf.groupby(by&#x3D;&#39;user_id&#39;).sum().query(&#39;order_amount &lt;&#x3D; 1000&#39;)[&#39;order_amount&#39;]\ndf.groupby(by&#x3D;&#39;user_id&#39;).sum().query(&#39;order_amount &lt;&#x3D; 1000&#39;)[&#39;order_amount&#39;].hist()</code></pre>\n\n\n\n\n<pre><code>&lt;matplotlib.axes._subplots.AxesSubplot at 0x1122f1d30&gt;\n</code></pre>\n<p>​    <img src=\"/./assets/%E7%AC%94%E8%AE%B0_22_1.png\" alt=\"笔记_22_1\"></p>\n<pre class=\"line-numbers language-python\" data-language=\"python\"><code class=\"language-python\">#各个用户消费的总数量的直方分布图(消费商品的数量在100次之内的分布)\ndf.groupby(by&#x3D;&#39;user_id&#39;).sum().query(&#39;order_product &lt;&#x3D; 100&#39;)[&#39;order_product&#39;].hist()</code></pre>\n\n\n\n\n<pre><code>&lt;matplotlib.axes._subplots.AxesSubplot at 0x11491f828&gt;\n</code></pre>\n<p>​    <img src=\"/./assets/%E7%AC%94%E8%AE%B0_23_1.png\" alt=\"笔记_23_1\"><br>​    </p>\n<h3 id=\"第四部分：用户消费行为分析\"><a href=\"#第四部分：用户消费行为分析\" class=\"headerlink\" title=\"第四部分：用户消费行为分析\"></a>第四部分：用户消费行为分析</h3><ul>\n<li>用户第一次消费的月份分布，和人数统计<ul>\n<li>绘制线形图</li>\n</ul>\n</li>\n<li>用户最后一次消费的时间分布，和人数统计<ul>\n<li>绘制线形图</li>\n</ul>\n</li>\n<li>新老客户的占比<ul>\n<li>消费一次为新用户</li>\n<li>消费多次为老用户<ul>\n<li>分析出每一个用户的第一个消费和最后一次消费的时间<ul>\n<li>agg([‘func1’,’func2’]):对分组后的结果进行指定聚合</li>\n</ul>\n</li>\n<li>分析出新老客户的消费比例</li>\n</ul>\n</li>\n</ul>\n</li>\n<li>用户分层<ul>\n<li>分析得出每个用户的总购买量和总消费金额and最近一次消费的时间的表格rfm</li>\n<li>RFM模型设计<ul>\n<li>R表示客户最近一次交易时间的间隔。<ul>\n<li>&#x2F;np.timedelta64(1,’D’)：去除days</li>\n</ul>\n</li>\n<li>F表示客户购买商品的总数量,F值越大，表示客户交易越频繁，反之则表示客户交易不够活跃。</li>\n<li>M表示客户交易的金额。M值越大，表示客户价值越高，反之则表示客户价值越低。</li>\n<li>将R，F，M作用到rfm表中</li>\n</ul>\n</li>\n<li>根据价值分层，将用户分为：<ul>\n<li>重要价值客户</li>\n<li>重要保持客户</li>\n<li>重要挽留客户</li>\n<li>重要发展客户</li>\n<li>一般价值客户</li>\n<li>一般保持客户</li>\n<li>一般挽留客户</li>\n<li>一般发展客户<ul>\n<li>使用已有的分层模型即可rfm_func</li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n<pre class=\"line-numbers language-python\" data-language=\"python\"><code class=\"language-python\">#用户第一次消费的月份分布，和人数统计\n#第一次消费的月份：每一个用户消费月份的最小值就是该用户第一次消费的月份\ndf.groupby(by&#x3D;&#39;user_id&#39;)[&#39;month&#39;].min()</code></pre>\n\n\n\n\n<pre><code>user_id\n1       1997-01-01\n2       1997-01-01\n3       1997-01-01\n4       1997-01-01\n5       1997-01-01\n6       1997-01-01\n7       1997-01-01\n8       1997-01-01\n9       1997-01-01\n10      1997-01-01\n11      1997-01-01\n12      1997-01-01\n13      1997-01-01\n14      1997-01-01\n15      1997-01-01\n16      1997-01-01\n17      1997-01-01\n18      1997-01-01\n19      1997-01-01\n20      1997-01-01\n21      1997-01-01\n22      1997-01-01\n23      1997-01-01\n24      1997-01-01\n25      1997-01-01\n26      1997-01-01\n27      1997-01-01\n28      1997-01-01\n29      1997-01-01\n30      1997-01-01\n           ...    \n23541   1997-03-01\n23542   1997-03-01\n23543   1997-03-01\n23544   1997-03-01\n23545   1997-03-01\n23546   1997-03-01\n23547   1997-03-01\n23548   1997-03-01\n23549   1997-03-01\n23550   1997-03-01\n23551   1997-03-01\n23552   1997-03-01\n23553   1997-03-01\n23554   1997-03-01\n23555   1997-03-01\n23556   1997-03-01\n23557   1997-03-01\n23558   1997-03-01\n23559   1997-03-01\n23560   1997-03-01\n23561   1997-03-01\n23562   1997-03-01\n23563   1997-03-01\n23564   1997-03-01\n23565   1997-03-01\n23566   1997-03-01\n23567   1997-03-01\n23568   1997-03-01\n23569   1997-03-01\n23570   1997-03-01\nName: month, Length: 23570, dtype: datetime64[ns]\n</code></pre>\n<pre class=\"line-numbers language-python\" data-language=\"python\"><code class=\"language-python\">df.groupby(by&#x3D;&#39;user_id&#39;)[&#39;month&#39;].min().value_counts() #人数的统计\ndf.groupby(by&#x3D;&#39;user_id&#39;)[&#39;month&#39;].min().value_counts().plot()</code></pre>\n\n\n\n\n<pre><code>&lt;matplotlib.axes._subplots.AxesSubplot at 0x11dddba90&gt;\n</code></pre>\n<p>​    <img src=\"/./assets/%E7%AC%94%E8%AE%B0_26_1.png\" alt=\"笔记_26_1\"></p>\n<pre class=\"line-numbers language-python\" data-language=\"python\"><code class=\"language-python\">#用户最后一次消费的时间分布，和人数统计\n#用户消费月份的最大值就是用户最后一次消费的月份\ndf.groupby(by&#x3D;&#39;user_id&#39;)[&#39;month&#39;].max().value_counts().plot()</code></pre>\n\n\n\n\n<pre><code>&lt;matplotlib.axes._subplots.AxesSubplot at 0x11e35ba58&gt;\n</code></pre>\n<p>​    <img src=\"/./assets/%E7%AC%94%E8%AE%B0_27_1.png\" alt=\"笔记_27_1\"></p>\n<pre class=\"line-numbers language-python\" data-language=\"python\"><code class=\"language-python\">#新老客户的占比\n#消费一次为新用户，消费多次为老用户\n#如何获知用户是否为第一次消费？可以根据用户的消费时间进行判定？\n    #如果用户的第一次消费时间和最后一次消费时间一样，则该用户只消费了一次为新用户，否则为老用户\nnew_old_user_df &#x3D; df.groupby(by&#x3D;&#39;user_id&#39;)[&#39;order_dt&#39;].agg([&#39;min&#39;,&#39;max&#39;])#agg对分组后的结果进行多种指定聚合\nnew_old_user_df[&#39;min&#39;] &#x3D;&#x3D; new_old_user_df[&#39;max&#39;] #True新用户，False老用户\n#统计True和False的个数\n(new_old_user_df[&#39;min&#39;] &#x3D;&#x3D; new_old_user_df[&#39;max&#39;]).value_counts()</code></pre>\n\n\n\n\n<pre><code>True     12054\nFalse    11516\ndtype: int64\n</code></pre>\n<pre class=\"line-numbers language-python\" data-language=\"python\"><code class=\"language-python\">#分析得出每个用户的总购买量和总消费金额and最近一次消费的时间的表格rfm\nrfm &#x3D; df.pivot_table(index&#x3D;&#39;user_id&#39;,aggfunc&#x3D;&#123;&#39;order_product&#39;:&#39;sum&#39;,&#39;order_amount&#39;:&#39;sum&#39;,&#39;order_dt&#39;:&quot;max&quot;&#125;)\nrfm</code></pre>\n\n\n\n\n<div>\n<style scoped>\n    .dataframe tbody tr th:only-of-type {\n        vertical-align: middle;\n    }\n\n<pre><code>.dataframe tbody tr th &#123;\n    vertical-align: top;\n&#125;\n\n.dataframe thead th &#123;\n    text-align: right;\n&#125;\n</code></pre>\n<p></style></p>\n<table border=\"1\" class=\"dataframe\">\n  <thead>\n    <tr style=\"text-align: right;\">\n      <th></th>\n      <th>order_amount</th>\n      <th>order_dt</th>\n      <th>order_product</th>\n    </tr>\n    <tr>\n      <th>user_id</th>\n      <th></th>\n      <th></th>\n      <th></th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <th>1</th>\n      <td>11.77</td>\n      <td>1997-01-01</td>\n      <td>1</td>\n    </tr>\n    <tr>\n      <th>2</th>\n      <td>89.00</td>\n      <td>1997-01-12</td>\n      <td>6</td>\n    </tr>\n    <tr>\n      <th>3</th>\n      <td>156.46</td>\n      <td>1998-05-28</td>\n      <td>16</td>\n    </tr>\n    <tr>\n      <th>4</th>\n      <td>100.50</td>\n      <td>1997-12-12</td>\n      <td>7</td>\n    </tr>\n    <tr>\n      <th>5</th>\n      <td>385.61</td>\n      <td>1998-01-03</td>\n      <td>29</td>\n    </tr>\n    <tr>\n      <th>6</th>\n      <td>20.99</td>\n      <td>1997-01-01</td>\n      <td>1</td>\n    </tr>\n    <tr>\n      <th>7</th>\n      <td>264.67</td>\n      <td>1998-03-22</td>\n      <td>18</td>\n    </tr>\n    <tr>\n      <th>8</th>\n      <td>197.66</td>\n      <td>1998-03-29</td>\n      <td>18</td>\n    </tr>\n    <tr>\n      <th>9</th>\n      <td>95.85</td>\n      <td>1998-06-08</td>\n      <td>6</td>\n    </tr>\n    <tr>\n      <th>10</th>\n      <td>39.31</td>\n      <td>1997-01-21</td>\n      <td>3</td>\n    </tr>\n    <tr>\n      <th>11</th>\n      <td>58.55</td>\n      <td>1998-02-20</td>\n      <td>4</td>\n    </tr>\n    <tr>\n      <th>12</th>\n      <td>57.06</td>\n      <td>1997-01-01</td>\n      <td>4</td>\n    </tr>\n    <tr>\n      <th>13</th>\n      <td>72.94</td>\n      <td>1997-01-01</td>\n      <td>4</td>\n    </tr>\n    <tr>\n      <th>14</th>\n      <td>29.92</td>\n      <td>1997-01-01</td>\n      <td>2</td>\n    </tr>\n    <tr>\n      <th>15</th>\n      <td>52.87</td>\n      <td>1997-01-01</td>\n      <td>4</td>\n    </tr>\n    <tr>\n      <th>16</th>\n      <td>79.87</td>\n      <td>1997-09-10</td>\n      <td>8</td>\n    </tr>\n    <tr>\n      <th>17</th>\n      <td>73.22</td>\n      <td>1997-01-01</td>\n      <td>5</td>\n    </tr>\n    <tr>\n      <th>18</th>\n      <td>14.96</td>\n      <td>1997-01-04</td>\n      <td>1</td>\n    </tr>\n    <tr>\n      <th>19</th>\n      <td>175.12</td>\n      <td>1997-06-10</td>\n      <td>11</td>\n    </tr>\n    <tr>\n      <th>20</th>\n      <td>653.01</td>\n      <td>1997-01-18</td>\n      <td>46</td>\n    </tr>\n    <tr>\n      <th>21</th>\n      <td>75.11</td>\n      <td>1997-01-13</td>\n      <td>4</td>\n    </tr>\n    <tr>\n      <th>22</th>\n      <td>14.37</td>\n      <td>1997-01-01</td>\n      <td>1</td>\n    </tr>\n    <tr>\n      <th>23</th>\n      <td>24.74</td>\n      <td>1997-01-01</td>\n      <td>2</td>\n    </tr>\n    <tr>\n      <th>24</th>\n      <td>57.77</td>\n      <td>1998-01-20</td>\n      <td>4</td>\n    </tr>\n    <tr>\n      <th>25</th>\n      <td>137.53</td>\n      <td>1998-06-08</td>\n      <td>12</td>\n    </tr>\n    <tr>\n      <th>26</th>\n      <td>102.69</td>\n      <td>1997-01-26</td>\n      <td>6</td>\n    </tr>\n    <tr>\n      <th>27</th>\n      <td>135.87</td>\n      <td>1997-01-12</td>\n      <td>10</td>\n    </tr>\n    <tr>\n      <th>28</th>\n      <td>90.99</td>\n      <td>1997-03-08</td>\n      <td>7</td>\n    </tr>\n    <tr>\n      <th>29</th>\n      <td>435.81</td>\n      <td>1998-04-26</td>\n      <td>28</td>\n    </tr>\n    <tr>\n      <th>30</th>\n      <td>28.34</td>\n      <td>1997-02-14</td>\n      <td>2</td>\n    </tr>\n    <tr>\n      <th>...</th>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n    </tr>\n    <tr>\n      <th>23541</th>\n      <td>57.34</td>\n      <td>1997-04-02</td>\n      <td>2</td>\n    </tr>\n    <tr>\n      <th>23542</th>\n      <td>77.43</td>\n      <td>1997-03-25</td>\n      <td>5</td>\n    </tr>\n    <tr>\n      <th>23543</th>\n      <td>50.76</td>\n      <td>1997-03-25</td>\n      <td>2</td>\n    </tr>\n    <tr>\n      <th>23544</th>\n      <td>134.63</td>\n      <td>1998-01-24</td>\n      <td>12</td>\n    </tr>\n    <tr>\n      <th>23545</th>\n      <td>24.99</td>\n      <td>1997-03-25</td>\n      <td>1</td>\n    </tr>\n    <tr>\n      <th>23546</th>\n      <td>13.97</td>\n      <td>1997-03-25</td>\n      <td>1</td>\n    </tr>\n    <tr>\n      <th>23547</th>\n      <td>23.54</td>\n      <td>1997-04-07</td>\n      <td>2</td>\n    </tr>\n    <tr>\n      <th>23548</th>\n      <td>23.54</td>\n      <td>1997-03-25</td>\n      <td>2</td>\n    </tr>\n    <tr>\n      <th>23549</th>\n      <td>27.13</td>\n      <td>1997-03-25</td>\n      <td>2</td>\n    </tr>\n    <tr>\n      <th>23550</th>\n      <td>25.28</td>\n      <td>1997-03-25</td>\n      <td>2</td>\n    </tr>\n    <tr>\n      <th>23551</th>\n      <td>264.63</td>\n      <td>1997-09-11</td>\n      <td>12</td>\n    </tr>\n    <tr>\n      <th>23552</th>\n      <td>49.38</td>\n      <td>1997-04-03</td>\n      <td>4</td>\n    </tr>\n    <tr>\n      <th>23553</th>\n      <td>98.58</td>\n      <td>1997-03-28</td>\n      <td>8</td>\n    </tr>\n    <tr>\n      <th>23554</th>\n      <td>36.37</td>\n      <td>1998-02-01</td>\n      <td>3</td>\n    </tr>\n    <tr>\n      <th>23555</th>\n      <td>189.18</td>\n      <td>1998-06-10</td>\n      <td>14</td>\n    </tr>\n    <tr>\n      <th>23556</th>\n      <td>203.00</td>\n      <td>1998-06-07</td>\n      <td>15</td>\n    </tr>\n    <tr>\n      <th>23557</th>\n      <td>14.37</td>\n      <td>1997-03-25</td>\n      <td>1</td>\n    </tr>\n    <tr>\n      <th>23558</th>\n      <td>145.60</td>\n      <td>1998-02-25</td>\n      <td>11</td>\n    </tr>\n    <tr>\n      <th>23559</th>\n      <td>111.65</td>\n      <td>1997-06-27</td>\n      <td>8</td>\n    </tr>\n    <tr>\n      <th>23560</th>\n      <td>18.36</td>\n      <td>1997-03-25</td>\n      <td>1</td>\n    </tr>\n    <tr>\n      <th>23561</th>\n      <td>83.46</td>\n      <td>1998-05-29</td>\n      <td>6</td>\n    </tr>\n    <tr>\n      <th>23562</th>\n      <td>29.33</td>\n      <td>1997-03-25</td>\n      <td>2</td>\n    </tr>\n    <tr>\n      <th>23563</th>\n      <td>58.75</td>\n      <td>1997-10-04</td>\n      <td>3</td>\n    </tr>\n    <tr>\n      <th>23564</th>\n      <td>70.01</td>\n      <td>1997-11-30</td>\n      <td>5</td>\n    </tr>\n    <tr>\n      <th>23565</th>\n      <td>11.77</td>\n      <td>1997-03-25</td>\n      <td>1</td>\n    </tr>\n    <tr>\n      <th>23566</th>\n      <td>36.00</td>\n      <td>1997-03-25</td>\n      <td>2</td>\n    </tr>\n    <tr>\n      <th>23567</th>\n      <td>20.97</td>\n      <td>1997-03-25</td>\n      <td>1</td>\n    </tr>\n    <tr>\n      <th>23568</th>\n      <td>121.70</td>\n      <td>1997-04-22</td>\n      <td>6</td>\n    </tr>\n    <tr>\n      <th>23569</th>\n      <td>25.74</td>\n      <td>1997-03-25</td>\n      <td>2</td>\n    </tr>\n    <tr>\n      <th>23570</th>\n      <td>94.08</td>\n      <td>1997-03-26</td>\n      <td>5</td>\n    </tr>\n  </tbody>\n</table>\n<p>23570 rows × 3 columns</p>\n</div>\n\n\n\n\n<pre class=\"line-numbers language-python\" data-language=\"python\"><code class=\"language-python\">#R表示客户最近一次交易时间的间隔\nmax_dt &#x3D; df[&#39;order_dt&#39;].max() #今天的日期\n#每一个用户最后一次交易的时间\n-(df.groupby(by&#x3D;&#39;user_id&#39;)[&#39;order_dt&#39;].max() - max_dt)\nrfm[&#39;R&#39;] &#x3D; -(df.groupby(by&#x3D;&#39;user_id&#39;)[&#39;order_dt&#39;].max() - max_dt)&#x2F;np.timedelta64(1,&#39;D&#39;)</code></pre>\n\n\n<pre class=\"line-numbers language-python\" data-language=\"python\"><code class=\"language-python\">rfm.drop(labels&#x3D;&#39;order_dt&#39;,axis&#x3D;1,inplace&#x3D;True)</code></pre>\n\n\n<pre class=\"line-numbers language-python\" data-language=\"python\"><code class=\"language-python\">rfm.columns &#x3D; [&#39;M&#39;,&#39;F&#39;,&#39;R&#39;]\nrfm.head()</code></pre>\n\n\n\n\n<div>\n<style scoped>\n    .dataframe tbody tr th:only-of-type {\n        vertical-align: middle;\n    }\n\n<pre><code>.dataframe tbody tr th &#123;\n    vertical-align: top;\n&#125;\n\n.dataframe thead th &#123;\n    text-align: right;\n&#125;\n</code></pre>\n<p></style></p>\n<table border=\"1\" class=\"dataframe\">\n  <thead>\n    <tr style=\"text-align: right;\">\n      <th></th>\n      <th>M</th>\n      <th>F</th>\n      <th>R</th>\n    </tr>\n    <tr>\n      <th>user_id</th>\n      <th></th>\n      <th></th>\n      <th></th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <th>1</th>\n      <td>11.77</td>\n      <td>1</td>\n      <td>545.0</td>\n    </tr>\n    <tr>\n      <th>2</th>\n      <td>89.00</td>\n      <td>6</td>\n      <td>534.0</td>\n    </tr>\n    <tr>\n      <th>3</th>\n      <td>156.46</td>\n      <td>16</td>\n      <td>33.0</td>\n    </tr>\n    <tr>\n      <th>4</th>\n      <td>100.50</td>\n      <td>7</td>\n      <td>200.0</td>\n    </tr>\n    <tr>\n      <th>5</th>\n      <td>385.61</td>\n      <td>29</td>\n      <td>178.0</td>\n    </tr>\n  </tbody>\n</table>\n</div>\n\n\n\n\n<pre class=\"line-numbers language-python\" data-language=\"python\"><code class=\"language-python\">def rfm_func(x):\n    #存储存储的是三个字符串形式的0或者1\n    level &#x3D; x.map(lambda x :&#39;1&#39; if x &gt;&#x3D; 0 else &#39;0&#39;)\n    label &#x3D; level.R + level.F + level.M\n    d &#x3D; &#123;\n        &#39;111&#39;:&#39;重要价值客户&#39;,\n        &#39;011&#39;:&#39;重要保持客户&#39;,\n        &#39;101&#39;:&#39;重要挽留客户&#39;,\n        &#39;001&#39;:&#39;重要发展客户&#39;,\n        &#39;110&#39;:&#39;一般价值客户&#39;,\n        &#39;010&#39;:&#39;一般保持客户&#39;,\n        &#39;100&#39;:&#39;一般挽留客户&#39;,\n        &#39;000&#39;:&#39;一般发展客户&#39;\n    &#125;\n    result &#x3D; d[label]\n    return result\n#df.apply(func):可以对df中的行或者列进行某种（func）形式的运算\nrfm[&#39;label&#39;] &#x3D; rfm.apply(lambda x : x - x.mean()).apply(rfm_func,axis &#x3D; 1)\nrfm.head()</code></pre>\n\n\n\n\n<div>\n<style scoped>\n    .dataframe tbody tr th:only-of-type {\n        vertical-align: middle;\n    }\n\n<pre><code>.dataframe tbody tr th &#123;\n    vertical-align: top;\n&#125;\n\n.dataframe thead th &#123;\n    text-align: right;\n&#125;\n</code></pre>\n<p></style></p>\n<table border=\"1\" class=\"dataframe\">\n  <thead>\n    <tr style=\"text-align: right;\">\n      <th></th>\n      <th>M</th>\n      <th>F</th>\n      <th>R</th>\n      <th>label</th>\n    </tr>\n    <tr>\n      <th>user_id</th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <th>1</th>\n      <td>11.77</td>\n      <td>1</td>\n      <td>545.0</td>\n      <td>一般挽留客户</td>\n    </tr>\n    <tr>\n      <th>2</th>\n      <td>89.00</td>\n      <td>6</td>\n      <td>534.0</td>\n      <td>一般挽留客户</td>\n    </tr>\n    <tr>\n      <th>3</th>\n      <td>156.46</td>\n      <td>16</td>\n      <td>33.0</td>\n      <td>重要保持客户</td>\n    </tr>\n    <tr>\n      <th>4</th>\n      <td>100.50</td>\n      <td>7</td>\n      <td>200.0</td>\n      <td>一般发展客户</td>\n    </tr>\n    <tr>\n      <th>5</th>\n      <td>385.61</td>\n      <td>29</td>\n      <td>178.0</td>\n      <td>重要保持客户</td>\n    </tr>\n  </tbody>\n</table>\n</div>\n\n\n\n<h3 id=\"第五部分：用户的生命周期\"><a href=\"#第五部分：用户的生命周期\" class=\"headerlink\" title=\"第五部分：用户的生命周期\"></a>第五部分：用户的生命周期</h3><ul>\n<li>将用户划分为活跃用户和其他用户<ul>\n<li>统计每个用户每个月的消费次数</li>\n<li>统计每个用户每个月是否消费，消费记录为1否则记录为0<ul>\n<li>知识点：DataFrame的apply和applymap的区别<ul>\n<li>applymap:返回df</li>\n<li>将函数做用于DataFrame中的所有元素(elements)</li>\n<li>apply:返回Series</li>\n<li>apply()将一个函数作用于DataFrame中的每个行或者列</li>\n</ul>\n</li>\n</ul>\n</li>\n<li>将用户按照每一个月份分成：<ul>\n<li>unreg:观望用户（前两月没买，第三个月才第一次买,则用户前两个月为观望用户）</li>\n<li>unactive:首月购买后，后序月份没有购买则在没有购买的月份中该用户的为非活跃用户</li>\n<li>new:当前月就进行首次购买的用户在当前月为新用户</li>\n<li>active:连续月份购买的用户在这些月中为活跃用户</li>\n<li>return:购买之后间隔n月再次购买的第一个月份为该月份的回头客</li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n<pre class=\"line-numbers language-python\" data-language=\"python\"><code class=\"language-python\">#统计每个用户每个月的消费次数\nuser_month_count_df &#x3D; df.pivot_table(index&#x3D;&#39;user_id&#39;,values&#x3D;&#39;order_dt&#39;,aggfunc&#x3D;&#39;count&#39;,columns&#x3D;&#39;month&#39;).fillna(0)</code></pre>\n\n\n<pre class=\"line-numbers language-python\" data-language=\"python\"><code class=\"language-python\">user_month_count_df.head()</code></pre>\n\n\n\n\n<div>\n<style scoped>\n    .dataframe tbody tr th:only-of-type {\n        vertical-align: middle;\n    }\n\n<pre><code>.dataframe tbody tr th &#123;\n    vertical-align: top;\n&#125;\n\n.dataframe thead th &#123;\n    text-align: right;\n&#125;\n</code></pre>\n<p></style></p>\n<table border=\"1\" class=\"dataframe\">\n  <thead>\n    <tr style=\"text-align: right;\">\n      <th>month</th>\n      <th>1997-01-01 00:00:00</th>\n      <th>1997-02-01 00:00:00</th>\n      <th>1997-03-01 00:00:00</th>\n      <th>1997-04-01 00:00:00</th>\n      <th>1997-05-01 00:00:00</th>\n      <th>1997-06-01 00:00:00</th>\n      <th>1997-07-01 00:00:00</th>\n      <th>1997-08-01 00:00:00</th>\n      <th>1997-09-01 00:00:00</th>\n      <th>1997-10-01 00:00:00</th>\n      <th>1997-11-01 00:00:00</th>\n      <th>1997-12-01 00:00:00</th>\n      <th>1998-01-01 00:00:00</th>\n      <th>1998-02-01 00:00:00</th>\n      <th>1998-03-01 00:00:00</th>\n      <th>1998-04-01 00:00:00</th>\n      <th>1998-05-01 00:00:00</th>\n      <th>1998-06-01 00:00:00</th>\n    </tr>\n    <tr>\n      <th>user_id</th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <th>1</th>\n      <td>1.0</td>\n      <td>0.0</td>\n      <td>0.0</td>\n      <td>0.0</td>\n      <td>0.0</td>\n      <td>0.0</td>\n      <td>0.0</td>\n      <td>0.0</td>\n      <td>0.0</td>\n      <td>0.0</td>\n      <td>0.0</td>\n      <td>0.0</td>\n      <td>0.0</td>\n      <td>0.0</td>\n      <td>0.0</td>\n      <td>0.0</td>\n      <td>0.0</td>\n      <td>0.0</td>\n    </tr>\n    <tr>\n      <th>2</th>\n      <td>2.0</td>\n      <td>0.0</td>\n      <td>0.0</td>\n      <td>0.0</td>\n      <td>0.0</td>\n      <td>0.0</td>\n      <td>0.0</td>\n      <td>0.0</td>\n      <td>0.0</td>\n      <td>0.0</td>\n      <td>0.0</td>\n      <td>0.0</td>\n      <td>0.0</td>\n      <td>0.0</td>\n      <td>0.0</td>\n      <td>0.0</td>\n      <td>0.0</td>\n      <td>0.0</td>\n    </tr>\n    <tr>\n      <th>3</th>\n      <td>1.0</td>\n      <td>0.0</td>\n      <td>1.0</td>\n      <td>1.0</td>\n      <td>0.0</td>\n      <td>0.0</td>\n      <td>0.0</td>\n      <td>0.0</td>\n      <td>0.0</td>\n      <td>0.0</td>\n      <td>2.0</td>\n      <td>0.0</td>\n      <td>0.0</td>\n      <td>0.0</td>\n      <td>0.0</td>\n      <td>0.0</td>\n      <td>1.0</td>\n      <td>0.0</td>\n    </tr>\n    <tr>\n      <th>4</th>\n      <td>2.0</td>\n      <td>0.0</td>\n      <td>0.0</td>\n      <td>0.0</td>\n      <td>0.0</td>\n      <td>0.0</td>\n      <td>0.0</td>\n      <td>1.0</td>\n      <td>0.0</td>\n      <td>0.0</td>\n      <td>0.0</td>\n      <td>1.0</td>\n      <td>0.0</td>\n      <td>0.0</td>\n      <td>0.0</td>\n      <td>0.0</td>\n      <td>0.0</td>\n      <td>0.0</td>\n    </tr>\n    <tr>\n      <th>5</th>\n      <td>2.0</td>\n      <td>1.0</td>\n      <td>0.0</td>\n      <td>1.0</td>\n      <td>1.0</td>\n      <td>1.0</td>\n      <td>1.0</td>\n      <td>0.0</td>\n      <td>1.0</td>\n      <td>0.0</td>\n      <td>0.0</td>\n      <td>2.0</td>\n      <td>1.0</td>\n      <td>0.0</td>\n      <td>0.0</td>\n      <td>0.0</td>\n      <td>0.0</td>\n      <td>0.0</td>\n    </tr>\n  </tbody>\n</table>\n</div>\n\n\n\n\n<pre class=\"line-numbers language-python\" data-language=\"python\"><code class=\"language-python\">#统计每个用户每个月是否消费，消费记录为1否则记录为0\ndf_purchase &#x3D; user_month_count_df.applymap(lambda x:1 if x &gt;&#x3D; 1 else 0)\n</code></pre>\n\n\n\n\n<div>\n<style scoped>\n    .dataframe tbody tr th:only-of-type {\n        vertical-align: middle;\n    }\n\n<pre><code>.dataframe tbody tr th &#123;\n    vertical-align: top;\n&#125;\n\n.dataframe thead th &#123;\n    text-align: right;\n&#125;\n</code></pre>\n<p></style></p>\n<table border=\"1\" class=\"dataframe\">\n  <thead>\n    <tr style=\"text-align: right;\">\n      <th>month</th>\n      <th>1997-01-01 00:00:00</th>\n      <th>1997-02-01 00:00:00</th>\n      <th>1997-03-01 00:00:00</th>\n      <th>1997-04-01 00:00:00</th>\n      <th>1997-05-01 00:00:00</th>\n      <th>1997-06-01 00:00:00</th>\n      <th>1997-07-01 00:00:00</th>\n      <th>1997-08-01 00:00:00</th>\n      <th>1997-09-01 00:00:00</th>\n      <th>1997-10-01 00:00:00</th>\n      <th>1997-11-01 00:00:00</th>\n      <th>1997-12-01 00:00:00</th>\n      <th>1998-01-01 00:00:00</th>\n      <th>1998-02-01 00:00:00</th>\n      <th>1998-03-01 00:00:00</th>\n      <th>1998-04-01 00:00:00</th>\n      <th>1998-05-01 00:00:00</th>\n      <th>1998-06-01 00:00:00</th>\n    </tr>\n    <tr>\n      <th>user_id</th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <th>1</th>\n      <td>1</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n    </tr>\n    <tr>\n      <th>2</th>\n      <td>1</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n    </tr>\n    <tr>\n      <th>3</th>\n      <td>1</td>\n      <td>0</td>\n      <td>1</td>\n      <td>1</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>1</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>1</td>\n      <td>0</td>\n    </tr>\n    <tr>\n      <th>4</th>\n      <td>1</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>1</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>1</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n    </tr>\n    <tr>\n      <th>5</th>\n      <td>1</td>\n      <td>1</td>\n      <td>0</td>\n      <td>1</td>\n      <td>1</td>\n      <td>1</td>\n      <td>1</td>\n      <td>0</td>\n      <td>1</td>\n      <td>0</td>\n      <td>0</td>\n      <td>1</td>\n      <td>1</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n    </tr>\n    <tr>\n      <th>6</th>\n      <td>1</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n    </tr>\n    <tr>\n      <th>7</th>\n      <td>1</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>1</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>1</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n    </tr>\n    <tr>\n      <th>8</th>\n      <td>1</td>\n      <td>1</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>1</td>\n      <td>1</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>1</td>\n      <td>1</td>\n      <td>0</td>\n      <td>0</td>\n      <td>1</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n    </tr>\n    <tr>\n      <th>9</th>\n      <td>1</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>1</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>1</td>\n    </tr>\n    <tr>\n      <th>10</th>\n      <td>1</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n    </tr>\n    <tr>\n      <th>11</th>\n      <td>1</td>\n      <td>0</td>\n      <td>1</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>1</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n    </tr>\n    <tr>\n      <th>12</th>\n      <td>1</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n    </tr>\n    <tr>\n      <th>13</th>\n      <td>1</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n    </tr>\n    <tr>\n      <th>14</th>\n      <td>1</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n    </tr>\n    <tr>\n      <th>15</th>\n      <td>1</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n    </tr>\n    <tr>\n      <th>16</th>\n      <td>1</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>1</td>\n      <td>0</td>\n      <td>1</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n    </tr>\n    <tr>\n      <th>17</th>\n      <td>1</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n    </tr>\n    <tr>\n      <th>18</th>\n      <td>1</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n    </tr>\n    <tr>\n      <th>19</th>\n      <td>1</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>1</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n    </tr>\n    <tr>\n      <th>20</th>\n      <td>1</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n    </tr>\n    <tr>\n      <th>21</th>\n      <td>1</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n    </tr>\n    <tr>\n      <th>22</th>\n      <td>1</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n    </tr>\n    <tr>\n      <th>23</th>\n      <td>1</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n    </tr>\n    <tr>\n      <th>24</th>\n      <td>1</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>1</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n    </tr>\n    <tr>\n      <th>25</th>\n      <td>1</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>1</td>\n      <td>1</td>\n      <td>0</td>\n      <td>1</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>1</td>\n      <td>1</td>\n      <td>1</td>\n    </tr>\n    <tr>\n      <th>26</th>\n      <td>1</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n    </tr>\n    <tr>\n      <th>27</th>\n      <td>1</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n    </tr>\n    <tr>\n      <th>28</th>\n      <td>1</td>\n      <td>0</td>\n      <td>1</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n    </tr>\n    <tr>\n      <th>29</th>\n      <td>1</td>\n      <td>1</td>\n      <td>1</td>\n      <td>1</td>\n      <td>1</td>\n      <td>0</td>\n      <td>1</td>\n      <td>0</td>\n      <td>1</td>\n      <td>0</td>\n      <td>1</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>1</td>\n      <td>0</td>\n      <td>0</td>\n    </tr>\n    <tr>\n      <th>30</th>\n      <td>1</td>\n      <td>1</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n    </tr>\n    <tr>\n      <th>...</th>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n    </tr>\n    <tr>\n      <th>23541</th>\n      <td>0</td>\n      <td>0</td>\n      <td>1</td>\n      <td>1</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n    </tr>\n    <tr>\n      <th>23542</th>\n      <td>0</td>\n      <td>0</td>\n      <td>1</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n    </tr>\n    <tr>\n      <th>23543</th>\n      <td>0</td>\n      <td>0</td>\n      <td>1</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n    </tr>\n    <tr>\n      <th>23544</th>\n      <td>0</td>\n      <td>0</td>\n      <td>1</td>\n      <td>0</td>\n      <td>1</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>1</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n    </tr>\n    <tr>\n      <th>23545</th>\n      <td>0</td>\n      <td>0</td>\n      <td>1</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n    </tr>\n    <tr>\n      <th>23546</th>\n      <td>0</td>\n      <td>0</td>\n      <td>1</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n    </tr>\n    <tr>\n      <th>23547</th>\n      <td>0</td>\n      <td>0</td>\n      <td>1</td>\n      <td>1</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n    </tr>\n    <tr>\n      <th>23548</th>\n      <td>0</td>\n      <td>0</td>\n      <td>1</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n    </tr>\n    <tr>\n      <th>23549</th>\n      <td>0</td>\n      <td>0</td>\n      <td>1</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n    </tr>\n    <tr>\n      <th>23550</th>\n      <td>0</td>\n      <td>0</td>\n      <td>1</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n    </tr>\n    <tr>\n      <th>23551</th>\n      <td>0</td>\n      <td>0</td>\n      <td>1</td>\n      <td>0</td>\n      <td>0</td>\n      <td>1</td>\n      <td>0</td>\n      <td>1</td>\n      <td>1</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n    </tr>\n    <tr>\n      <th>23552</th>\n      <td>0</td>\n      <td>0</td>\n      <td>1</td>\n      <td>1</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n    </tr>\n    <tr>\n      <th>23553</th>\n      <td>0</td>\n      <td>0</td>\n      <td>1</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n    </tr>\n    <tr>\n      <th>23554</th>\n      <td>0</td>\n      <td>0</td>\n      <td>1</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>1</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n    </tr>\n    <tr>\n      <th>23555</th>\n      <td>0</td>\n      <td>0</td>\n      <td>1</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>1</td>\n      <td>0</td>\n      <td>1</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>1</td>\n      <td>1</td>\n    </tr>\n    <tr>\n      <th>23556</th>\n      <td>0</td>\n      <td>0</td>\n      <td>1</td>\n      <td>0</td>\n      <td>0</td>\n      <td>1</td>\n      <td>1</td>\n      <td>0</td>\n      <td>1</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>1</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>1</td>\n    </tr>\n    <tr>\n      <th>23557</th>\n      <td>0</td>\n      <td>0</td>\n      <td>1</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n    </tr>\n    <tr>\n      <th>23558</th>\n      <td>0</td>\n      <td>0</td>\n      <td>1</td>\n      <td>0</td>\n      <td>1</td>\n      <td>1</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>1</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n    </tr>\n    <tr>\n      <th>23559</th>\n      <td>0</td>\n      <td>0</td>\n      <td>1</td>\n      <td>0</td>\n      <td>1</td>\n      <td>1</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n    </tr>\n    <tr>\n      <th>23560</th>\n      <td>0</td>\n      <td>0</td>\n      <td>1</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n    </tr>\n    <tr>\n      <th>23561</th>\n      <td>0</td>\n      <td>0</td>\n      <td>1</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>1</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>1</td>\n      <td>0</td>\n    </tr>\n    <tr>\n      <th>23562</th>\n      <td>0</td>\n      <td>0</td>\n      <td>1</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n    </tr>\n    <tr>\n      <th>23563</th>\n      <td>0</td>\n      <td>0</td>\n      <td>1</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>1</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n    </tr>\n    <tr>\n      <th>23564</th>\n      <td>0</td>\n      <td>0</td>\n      <td>1</td>\n      <td>0</td>\n      <td>1</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>1</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n    </tr>\n    <tr>\n      <th>23565</th>\n      <td>0</td>\n      <td>0</td>\n      <td>1</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n    </tr>\n    <tr>\n      <th>23566</th>\n      <td>0</td>\n      <td>0</td>\n      <td>1</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n    </tr>\n    <tr>\n      <th>23567</th>\n      <td>0</td>\n      <td>0</td>\n      <td>1</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n    </tr>\n    <tr>\n      <th>23568</th>\n      <td>0</td>\n      <td>0</td>\n      <td>1</td>\n      <td>1</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n    </tr>\n    <tr>\n      <th>23569</th>\n      <td>0</td>\n      <td>0</td>\n      <td>1</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n    </tr>\n    <tr>\n      <th>23570</th>\n      <td>0</td>\n      <td>0</td>\n      <td>1</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n    </tr>\n  </tbody>\n</table>\n<p>23570 rows × 18 columns</p>\n</div>\n\n\n\n\n<pre class=\"line-numbers language-python\" data-language=\"python\"><code class=\"language-python\">df_purchase.head()</code></pre>\n\n\n\n\n<div>\n<style scoped>\n    .dataframe tbody tr th:only-of-type {\n        vertical-align: middle;\n    }\n\n<pre><code>.dataframe tbody tr th &#123;\n    vertical-align: top;\n&#125;\n\n.dataframe thead th &#123;\n    text-align: right;\n&#125;\n</code></pre>\n<p></style></p>\n<table border=\"1\" class=\"dataframe\">\n  <thead>\n    <tr style=\"text-align: right;\">\n      <th>month</th>\n      <th>1997-01-01 00:00:00</th>\n      <th>1997-02-01 00:00:00</th>\n      <th>1997-03-01 00:00:00</th>\n      <th>1997-04-01 00:00:00</th>\n      <th>1997-05-01 00:00:00</th>\n      <th>1997-06-01 00:00:00</th>\n      <th>1997-07-01 00:00:00</th>\n      <th>1997-08-01 00:00:00</th>\n      <th>1997-09-01 00:00:00</th>\n      <th>1997-10-01 00:00:00</th>\n      <th>1997-11-01 00:00:00</th>\n      <th>1997-12-01 00:00:00</th>\n      <th>1998-01-01 00:00:00</th>\n      <th>1998-02-01 00:00:00</th>\n      <th>1998-03-01 00:00:00</th>\n      <th>1998-04-01 00:00:00</th>\n      <th>1998-05-01 00:00:00</th>\n      <th>1998-06-01 00:00:00</th>\n    </tr>\n    <tr>\n      <th>user_id</th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <th>1</th>\n      <td>1</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n    </tr>\n    <tr>\n      <th>2</th>\n      <td>1</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n    </tr>\n    <tr>\n      <th>3</th>\n      <td>1</td>\n      <td>0</td>\n      <td>1</td>\n      <td>1</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>1</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>1</td>\n      <td>0</td>\n    </tr>\n    <tr>\n      <th>4</th>\n      <td>1</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>1</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>1</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n    </tr>\n    <tr>\n      <th>5</th>\n      <td>1</td>\n      <td>1</td>\n      <td>0</td>\n      <td>1</td>\n      <td>1</td>\n      <td>1</td>\n      <td>1</td>\n      <td>0</td>\n      <td>1</td>\n      <td>0</td>\n      <td>0</td>\n      <td>1</td>\n      <td>1</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n    </tr>\n  </tbody>\n</table>\n</div>\n\n\n\n\n<pre class=\"line-numbers language-python\" data-language=\"python\"><code class=\"language-python\">#将df_purchase中的原始数据0和1修改为new，unactive......,返回新的df叫做df_purchase_new\n#固定算法\ndef active_status(data):\n    status &#x3D; []#某个用户每一个月的活跃度\n    for i in range(18):\n        \n        #若本月没有消费\n        if data[i] &#x3D;&#x3D; 0:\n            if len(status) &gt; 0:\n                if status[i-1] &#x3D;&#x3D; &#39;unreg&#39;:\n                    status.append(&#39;unreg&#39;)\n                else:\n                    status.append(&#39;unactive&#39;)\n            else:\n                status.append(&#39;unreg&#39;)\n                    \n        #若本月消费\n        else:\n            if len(status) &#x3D;&#x3D; 0:\n                status.append(&#39;new&#39;)\n            else:\n                if status[i-1] &#x3D;&#x3D; &#39;unactive&#39;:\n                    status.append(&#39;return&#39;)\n                elif status[i-1] &#x3D;&#x3D; &#39;unreg&#39;:\n                    status.append(&#39;new&#39;)\n                else:\n                    status.append(&#39;active&#39;)\n    return status\n\npivoted_status &#x3D; df_purchase.apply(active_status,axis &#x3D; 1) \npivoted_status.head()</code></pre>\n\n\n\n\n<pre><code>user_id\n1    [new, unactive, unactive, unactive, unactive, ...\n2    [new, unactive, unactive, unactive, unactive, ...\n3    [new, unactive, return, active, unactive, unac...\n4    [new, unactive, unactive, unactive, unactive, ...\n5    [new, active, unactive, return, active, active...\ndtype: object\n</code></pre>\n<pre class=\"line-numbers language-python\" data-language=\"python\"><code class=\"language-python\">df_purchase_new &#x3D; DataFrame(data&#x3D;pivoted_status.values.tolist(),index&#x3D;df_purchase.index,columns&#x3D;df_purchase.columns)\ndf_purchase_new</code></pre>\n\n\n\n\n<div>\n<style scoped>\n    .dataframe tbody tr th:only-of-type {\n        vertical-align: middle;\n    }\n\n<pre><code>.dataframe tbody tr th &#123;\n    vertical-align: top;\n&#125;\n\n.dataframe thead th &#123;\n    text-align: right;\n&#125;\n</code></pre>\n<p></style></p>\n<table border=\"1\" class=\"dataframe\">\n  <thead>\n    <tr style=\"text-align: right;\">\n      <th>month</th>\n      <th>1997-01-01 00:00:00</th>\n      <th>1997-02-01 00:00:00</th>\n      <th>1997-03-01 00:00:00</th>\n      <th>1997-04-01 00:00:00</th>\n      <th>1997-05-01 00:00:00</th>\n      <th>1997-06-01 00:00:00</th>\n      <th>1997-07-01 00:00:00</th>\n      <th>1997-08-01 00:00:00</th>\n      <th>1997-09-01 00:00:00</th>\n      <th>1997-10-01 00:00:00</th>\n      <th>1997-11-01 00:00:00</th>\n      <th>1997-12-01 00:00:00</th>\n      <th>1998-01-01 00:00:00</th>\n      <th>1998-02-01 00:00:00</th>\n      <th>1998-03-01 00:00:00</th>\n      <th>1998-04-01 00:00:00</th>\n      <th>1998-05-01 00:00:00</th>\n      <th>1998-06-01 00:00:00</th>\n    </tr>\n    <tr>\n      <th>user_id</th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <th>1</th>\n      <td>new</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n    </tr>\n    <tr>\n      <th>2</th>\n      <td>new</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n    </tr>\n    <tr>\n      <th>3</th>\n      <td>new</td>\n      <td>unactive</td>\n      <td>return</td>\n      <td>active</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>return</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>return</td>\n      <td>unactive</td>\n    </tr>\n    <tr>\n      <th>4</th>\n      <td>new</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>return</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>return</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n    </tr>\n    <tr>\n      <th>5</th>\n      <td>new</td>\n      <td>active</td>\n      <td>unactive</td>\n      <td>return</td>\n      <td>active</td>\n      <td>active</td>\n      <td>active</td>\n      <td>unactive</td>\n      <td>return</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>return</td>\n      <td>active</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n    </tr>\n    <tr>\n      <th>6</th>\n      <td>new</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n    </tr>\n    <tr>\n      <th>7</th>\n      <td>new</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>return</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>return</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n    </tr>\n    <tr>\n      <th>8</th>\n      <td>new</td>\n      <td>active</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>return</td>\n      <td>active</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>return</td>\n      <td>active</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>return</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n    </tr>\n    <tr>\n      <th>9</th>\n      <td>new</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>return</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>return</td>\n    </tr>\n    <tr>\n      <th>10</th>\n      <td>new</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n    </tr>\n    <tr>\n      <th>11</th>\n      <td>new</td>\n      <td>unactive</td>\n      <td>return</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>return</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n    </tr>\n    <tr>\n      <th>12</th>\n      <td>new</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n    </tr>\n    <tr>\n      <th>13</th>\n      <td>new</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n    </tr>\n    <tr>\n      <th>14</th>\n      <td>new</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n    </tr>\n    <tr>\n      <th>15</th>\n      <td>new</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n    </tr>\n    <tr>\n      <th>16</th>\n      <td>new</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>return</td>\n      <td>unactive</td>\n      <td>return</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n    </tr>\n    <tr>\n      <th>17</th>\n      <td>new</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n    </tr>\n    <tr>\n      <th>18</th>\n      <td>new</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n    </tr>\n    <tr>\n      <th>19</th>\n      <td>new</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>return</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n    </tr>\n    <tr>\n      <th>20</th>\n      <td>new</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n    </tr>\n    <tr>\n      <th>21</th>\n      <td>new</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n    </tr>\n    <tr>\n      <th>22</th>\n      <td>new</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n    </tr>\n    <tr>\n      <th>23</th>\n      <td>new</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n    </tr>\n    <tr>\n      <th>24</th>\n      <td>new</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>return</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n    </tr>\n    <tr>\n      <th>25</th>\n      <td>new</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>return</td>\n      <td>active</td>\n      <td>unactive</td>\n      <td>return</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>return</td>\n      <td>active</td>\n      <td>active</td>\n    </tr>\n    <tr>\n      <th>26</th>\n      <td>new</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n    </tr>\n    <tr>\n      <th>27</th>\n      <td>new</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n    </tr>\n    <tr>\n      <th>28</th>\n      <td>new</td>\n      <td>unactive</td>\n      <td>return</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n    </tr>\n    <tr>\n      <th>29</th>\n      <td>new</td>\n      <td>active</td>\n      <td>active</td>\n      <td>active</td>\n      <td>active</td>\n      <td>unactive</td>\n      <td>return</td>\n      <td>unactive</td>\n      <td>return</td>\n      <td>unactive</td>\n      <td>return</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>return</td>\n      <td>unactive</td>\n      <td>unactive</td>\n    </tr>\n    <tr>\n      <th>30</th>\n      <td>new</td>\n      <td>active</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n    </tr>\n    <tr>\n      <th>...</th>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n    </tr>\n    <tr>\n      <th>23541</th>\n      <td>unreg</td>\n      <td>unreg</td>\n      <td>new</td>\n      <td>active</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n    </tr>\n    <tr>\n      <th>23542</th>\n      <td>unreg</td>\n      <td>unreg</td>\n      <td>new</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n    </tr>\n    <tr>\n      <th>23543</th>\n      <td>unreg</td>\n      <td>unreg</td>\n      <td>new</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n    </tr>\n    <tr>\n      <th>23544</th>\n      <td>unreg</td>\n      <td>unreg</td>\n      <td>new</td>\n      <td>unactive</td>\n      <td>return</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>return</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n    </tr>\n    <tr>\n      <th>23545</th>\n      <td>unreg</td>\n      <td>unreg</td>\n      <td>new</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n    </tr>\n    <tr>\n      <th>23546</th>\n      <td>unreg</td>\n      <td>unreg</td>\n      <td>new</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n    </tr>\n    <tr>\n      <th>23547</th>\n      <td>unreg</td>\n      <td>unreg</td>\n      <td>new</td>\n      <td>active</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n    </tr>\n    <tr>\n      <th>23548</th>\n      <td>unreg</td>\n      <td>unreg</td>\n      <td>new</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n    </tr>\n    <tr>\n      <th>23549</th>\n      <td>unreg</td>\n      <td>unreg</td>\n      <td>new</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n    </tr>\n    <tr>\n      <th>23550</th>\n      <td>unreg</td>\n      <td>unreg</td>\n      <td>new</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n    </tr>\n    <tr>\n      <th>23551</th>\n      <td>unreg</td>\n      <td>unreg</td>\n      <td>new</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>return</td>\n      <td>unactive</td>\n      <td>return</td>\n      <td>active</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n    </tr>\n    <tr>\n      <th>23552</th>\n      <td>unreg</td>\n      <td>unreg</td>\n      <td>new</td>\n      <td>active</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n    </tr>\n    <tr>\n      <th>23553</th>\n      <td>unreg</td>\n      <td>unreg</td>\n      <td>new</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n    </tr>\n    <tr>\n      <th>23554</th>\n      <td>unreg</td>\n      <td>unreg</td>\n      <td>new</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>return</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n    </tr>\n    <tr>\n      <th>23555</th>\n      <td>unreg</td>\n      <td>unreg</td>\n      <td>new</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>return</td>\n      <td>unactive</td>\n      <td>return</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>return</td>\n      <td>active</td>\n    </tr>\n    <tr>\n      <th>23556</th>\n      <td>unreg</td>\n      <td>unreg</td>\n      <td>new</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>return</td>\n      <td>active</td>\n      <td>unactive</td>\n      <td>return</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>return</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>return</td>\n    </tr>\n    <tr>\n      <th>23557</th>\n      <td>unreg</td>\n      <td>unreg</td>\n      <td>new</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n    </tr>\n    <tr>\n      <th>23558</th>\n      <td>unreg</td>\n      <td>unreg</td>\n      <td>new</td>\n      <td>unactive</td>\n      <td>return</td>\n      <td>active</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>return</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n    </tr>\n    <tr>\n      <th>23559</th>\n      <td>unreg</td>\n      <td>unreg</td>\n      <td>new</td>\n      <td>unactive</td>\n      <td>return</td>\n      <td>active</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n    </tr>\n    <tr>\n      <th>23560</th>\n      <td>unreg</td>\n      <td>unreg</td>\n      <td>new</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n    </tr>\n    <tr>\n      <th>23561</th>\n      <td>unreg</td>\n      <td>unreg</td>\n      <td>new</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>return</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>return</td>\n      <td>unactive</td>\n    </tr>\n    <tr>\n      <th>23562</th>\n      <td>unreg</td>\n      <td>unreg</td>\n      <td>new</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n    </tr>\n    <tr>\n      <th>23563</th>\n      <td>unreg</td>\n      <td>unreg</td>\n      <td>new</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>return</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n    </tr>\n    <tr>\n      <th>23564</th>\n      <td>unreg</td>\n      <td>unreg</td>\n      <td>new</td>\n      <td>unactive</td>\n      <td>return</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>return</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n    </tr>\n    <tr>\n      <th>23565</th>\n      <td>unreg</td>\n      <td>unreg</td>\n      <td>new</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n    </tr>\n    <tr>\n      <th>23566</th>\n      <td>unreg</td>\n      <td>unreg</td>\n      <td>new</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n    </tr>\n    <tr>\n      <th>23567</th>\n      <td>unreg</td>\n      <td>unreg</td>\n      <td>new</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n    </tr>\n    <tr>\n      <th>23568</th>\n      <td>unreg</td>\n      <td>unreg</td>\n      <td>new</td>\n      <td>active</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n    </tr>\n    <tr>\n      <th>23569</th>\n      <td>unreg</td>\n      <td>unreg</td>\n      <td>new</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n    </tr>\n    <tr>\n      <th>23570</th>\n      <td>unreg</td>\n      <td>unreg</td>\n      <td>new</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n      <td>unactive</td>\n    </tr>\n  </tbody>\n</table>\n<p>23570 rows × 18 columns</p>\n</div>\n\n\n\n<ul>\n<li>每月【不同活跃】用户的计数<ul>\n<li>purchase_status_ct &#x3D; df_purchase_new.apply(lambda x : pd.value_counts(x)).fillna(0)</li>\n<li>转置进行最终结果的查看</li>\n</ul>\n</li>\n</ul>\n<pre class=\"line-numbers language-python\" data-language=\"python\"><code class=\"language-python\">purchase_status_ct &#x3D; df_purchase_new.apply(lambda x : pd.value_counts(x)).fillna(0)\npurchase_status_ct</code></pre>\n\n\n\n\n<div>\n<style scoped>\n    .dataframe tbody tr th:only-of-type {\n        vertical-align: middle;\n    }\n\n<pre><code>.dataframe tbody tr th &#123;\n    vertical-align: top;\n&#125;\n\n.dataframe thead th &#123;\n    text-align: right;\n&#125;\n</code></pre>\n<p></style></p>\n<table border=\"1\" class=\"dataframe\">\n  <thead>\n    <tr style=\"text-align: right;\">\n      <th>month</th>\n      <th>1997-01-01 00:00:00</th>\n      <th>1997-02-01 00:00:00</th>\n      <th>1997-03-01 00:00:00</th>\n      <th>1997-04-01 00:00:00</th>\n      <th>1997-05-01 00:00:00</th>\n      <th>1997-06-01 00:00:00</th>\n      <th>1997-07-01 00:00:00</th>\n      <th>1997-08-01 00:00:00</th>\n      <th>1997-09-01 00:00:00</th>\n      <th>1997-10-01 00:00:00</th>\n      <th>1997-11-01 00:00:00</th>\n      <th>1997-12-01 00:00:00</th>\n      <th>1998-01-01 00:00:00</th>\n      <th>1998-02-01 00:00:00</th>\n      <th>1998-03-01 00:00:00</th>\n      <th>1998-04-01 00:00:00</th>\n      <th>1998-05-01 00:00:00</th>\n      <th>1998-06-01 00:00:00</th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <th>active</th>\n      <td>0.0</td>\n      <td>1157.0</td>\n      <td>1681.0</td>\n      <td>1773.0</td>\n      <td>852.0</td>\n      <td>747.0</td>\n      <td>746.0</td>\n      <td>604.0</td>\n      <td>528.0</td>\n      <td>532.0</td>\n      <td>624.0</td>\n      <td>632.0</td>\n      <td>512.0</td>\n      <td>472.0</td>\n      <td>571.0</td>\n      <td>518.0</td>\n      <td>459.0</td>\n      <td>446.0</td>\n    </tr>\n    <tr>\n      <th>new</th>\n      <td>7846.0</td>\n      <td>8476.0</td>\n      <td>7248.0</td>\n      <td>0.0</td>\n      <td>0.0</td>\n      <td>0.0</td>\n      <td>0.0</td>\n      <td>0.0</td>\n      <td>0.0</td>\n      <td>0.0</td>\n      <td>0.0</td>\n      <td>0.0</td>\n      <td>0.0</td>\n      <td>0.0</td>\n      <td>0.0</td>\n      <td>0.0</td>\n      <td>0.0</td>\n      <td>0.0</td>\n    </tr>\n    <tr>\n      <th>return</th>\n      <td>0.0</td>\n      <td>0.0</td>\n      <td>595.0</td>\n      <td>1049.0</td>\n      <td>1362.0</td>\n      <td>1592.0</td>\n      <td>1434.0</td>\n      <td>1168.0</td>\n      <td>1211.0</td>\n      <td>1307.0</td>\n      <td>1404.0</td>\n      <td>1232.0</td>\n      <td>1025.0</td>\n      <td>1079.0</td>\n      <td>1489.0</td>\n      <td>919.0</td>\n      <td>1029.0</td>\n      <td>1060.0</td>\n    </tr>\n    <tr>\n      <th>unactive</th>\n      <td>0.0</td>\n      <td>6689.0</td>\n      <td>14046.0</td>\n      <td>20748.0</td>\n      <td>21356.0</td>\n      <td>21231.0</td>\n      <td>21390.0</td>\n      <td>21798.0</td>\n      <td>21831.0</td>\n      <td>21731.0</td>\n      <td>21542.0</td>\n      <td>21706.0</td>\n      <td>22033.0</td>\n      <td>22019.0</td>\n      <td>21510.0</td>\n      <td>22133.0</td>\n      <td>22082.0</td>\n      <td>22064.0</td>\n    </tr>\n    <tr>\n      <th>unreg</th>\n      <td>15724.0</td>\n      <td>7248.0</td>\n      <td>0.0</td>\n      <td>0.0</td>\n      <td>0.0</td>\n      <td>0.0</td>\n      <td>0.0</td>\n      <td>0.0</td>\n      <td>0.0</td>\n      <td>0.0</td>\n      <td>0.0</td>\n      <td>0.0</td>\n      <td>0.0</td>\n      <td>0.0</td>\n      <td>0.0</td>\n      <td>0.0</td>\n      <td>0.0</td>\n      <td>0.0</td>\n    </tr>\n  </tbody>\n</table>\n</div>\n\n\n\n\n<pre class=\"line-numbers language-python\" data-language=\"python\"><code class=\"language-python\">purchase_status_ct.T</code></pre>\n\n\n\n\n<div>\n<style scoped>\n    .dataframe tbody tr th:only-of-type {\n        vertical-align: middle;\n    }\n\n<pre><code>.dataframe tbody tr th &#123;\n    vertical-align: top;\n&#125;\n\n.dataframe thead th &#123;\n    text-align: right;\n&#125;\n</code></pre>\n<p></style></p>\n<table border=\"1\" class=\"dataframe\">\n  <thead>\n    <tr style=\"text-align: right;\">\n      <th></th>\n      <th>active</th>\n      <th>new</th>\n      <th>return</th>\n      <th>unactive</th>\n      <th>unreg</th>\n    </tr>\n    <tr>\n      <th>month</th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <th>1997-01-01</th>\n      <td>0.0</td>\n      <td>7846.0</td>\n      <td>0.0</td>\n      <td>0.0</td>\n      <td>15724.0</td>\n    </tr>\n    <tr>\n      <th>1997-02-01</th>\n      <td>1157.0</td>\n      <td>8476.0</td>\n      <td>0.0</td>\n      <td>6689.0</td>\n      <td>7248.0</td>\n    </tr>\n    <tr>\n      <th>1997-03-01</th>\n      <td>1681.0</td>\n      <td>7248.0</td>\n      <td>595.0</td>\n      <td>14046.0</td>\n      <td>0.0</td>\n    </tr>\n    <tr>\n      <th>1997-04-01</th>\n      <td>1773.0</td>\n      <td>0.0</td>\n      <td>1049.0</td>\n      <td>20748.0</td>\n      <td>0.0</td>\n    </tr>\n    <tr>\n      <th>1997-05-01</th>\n      <td>852.0</td>\n      <td>0.0</td>\n      <td>1362.0</td>\n      <td>21356.0</td>\n      <td>0.0</td>\n    </tr>\n    <tr>\n      <th>1997-06-01</th>\n      <td>747.0</td>\n      <td>0.0</td>\n      <td>1592.0</td>\n      <td>21231.0</td>\n      <td>0.0</td>\n    </tr>\n    <tr>\n      <th>1997-07-01</th>\n      <td>746.0</td>\n      <td>0.0</td>\n      <td>1434.0</td>\n      <td>21390.0</td>\n      <td>0.0</td>\n    </tr>\n    <tr>\n      <th>1997-08-01</th>\n      <td>604.0</td>\n      <td>0.0</td>\n      <td>1168.0</td>\n      <td>21798.0</td>\n      <td>0.0</td>\n    </tr>\n    <tr>\n      <th>1997-09-01</th>\n      <td>528.0</td>\n      <td>0.0</td>\n      <td>1211.0</td>\n      <td>21831.0</td>\n      <td>0.0</td>\n    </tr>\n    <tr>\n      <th>1997-10-01</th>\n      <td>532.0</td>\n      <td>0.0</td>\n      <td>1307.0</td>\n      <td>21731.0</td>\n      <td>0.0</td>\n    </tr>\n    <tr>\n      <th>1997-11-01</th>\n      <td>624.0</td>\n      <td>0.0</td>\n      <td>1404.0</td>\n      <td>21542.0</td>\n      <td>0.0</td>\n    </tr>\n    <tr>\n      <th>1997-12-01</th>\n      <td>632.0</td>\n      <td>0.0</td>\n      <td>1232.0</td>\n      <td>21706.0</td>\n      <td>0.0</td>\n    </tr>\n    <tr>\n      <th>1998-01-01</th>\n      <td>512.0</td>\n      <td>0.0</td>\n      <td>1025.0</td>\n      <td>22033.0</td>\n      <td>0.0</td>\n    </tr>\n    <tr>\n      <th>1998-02-01</th>\n      <td>472.0</td>\n      <td>0.0</td>\n      <td>1079.0</td>\n      <td>22019.0</td>\n      <td>0.0</td>\n    </tr>\n    <tr>\n      <th>1998-03-01</th>\n      <td>571.0</td>\n      <td>0.0</td>\n      <td>1489.0</td>\n      <td>21510.0</td>\n      <td>0.0</td>\n    </tr>\n    <tr>\n      <th>1998-04-01</th>\n      <td>518.0</td>\n      <td>0.0</td>\n      <td>919.0</td>\n      <td>22133.0</td>\n      <td>0.0</td>\n    </tr>\n    <tr>\n      <th>1998-05-01</th>\n      <td>459.0</td>\n      <td>0.0</td>\n      <td>1029.0</td>\n      <td>22082.0</td>\n      <td>0.0</td>\n    </tr>\n    <tr>\n      <th>1998-06-01</th>\n      <td>446.0</td>\n      <td>0.0</td>\n      <td>1060.0</td>\n      <td>22064.0</td>\n      <td>0.0</td>\n    </tr>\n  </tbody>\n</table>\n</div>\n\n\n\n\n<pre class=\"line-numbers language-python\" data-language=\"python\"><code class=\"language-python\"></code></pre>\n","text":"用户消费分析import numpy as np import pandas as pd from pandas import DataFrame,Series...","link":"","photos":[],"count_time":{"symbolsCount":"60k","symbolsTime":"54 mins."},"categories":[],"tags":[{"name":"pandas","slug":"pandas","count":3,"path":"api/tags/pandas.json"},{"name":"matplotlib","slug":"matplotlib","count":1,"path":"api/tags/matplotlib.json"}],"toc":"<ol class=\"toc\"><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#%E7%94%A8%E6%88%B7%E6%B6%88%E8%B4%B9%E5%88%86%E6%9E%90\"><span class=\"toc-text\">用户消费分析</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E7%AC%AC%E4%B8%80%E9%83%A8%E5%88%86%EF%BC%9A%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B%E5%A4%84%E7%90%86\"><span class=\"toc-text\">第一部分：数据类型处理</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E7%AC%AC%E4%BA%8C%E9%83%A8%E5%88%86%EF%BC%9A%E6%8C%89%E6%9C%88%E6%95%B0%E6%8D%AE%E5%88%86%E6%9E%90\"><span class=\"toc-text\">第二部分：按月数据分析</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E7%AC%AC%E4%B8%89%E9%83%A8%E5%88%86%EF%BC%9A%E7%94%A8%E6%88%B7%E4%B8%AA%E4%BD%93%E6%B6%88%E8%B4%B9%E6%95%B0%E6%8D%AE%E5%88%86%E6%9E%90\"><span class=\"toc-text\">第三部分：用户个体消费数据分析</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E7%AC%AC%E5%9B%9B%E9%83%A8%E5%88%86%EF%BC%9A%E7%94%A8%E6%88%B7%E6%B6%88%E8%B4%B9%E8%A1%8C%E4%B8%BA%E5%88%86%E6%9E%90\"><span class=\"toc-text\">第四部分：用户消费行为分析</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E7%AC%AC%E4%BA%94%E9%83%A8%E5%88%86%EF%BC%9A%E7%94%A8%E6%88%B7%E7%9A%84%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F\"><span class=\"toc-text\">第五部分：用户的生命周期</span></a></li></ol></li></ol></li></ol>","author":{"name":"verfotta","slug":"blog-author","avatar":"/icons/favicon-32x32.png","link":"/","description":"您好","socials":{"github":"","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}},"mapped":true,"hidden":false,"prev_post":{"title":"人口密度分析","uid":"ff52f4ae253aef32f50e414d6d2d634b","slug":"美国各州人口密度分析","date":"2023-09-09T04:17:53.000Z","updated":"2023-09-14T14:13:39.786Z","comments":true,"path":"api/articles/美国各州人口密度分析.json","keywords":null,"cover":null,"text":"美国各州人口密度分析import numpy as np import pandas as pd 首先导入文件，并查看数据样本# 州的全称和州名称简写对应关系表...","link":"","photos":[],"count_time":{"symbolsCount":"27k","symbolsTime":"24 mins."},"categories":[],"tags":[{"name":"pandas","slug":"pandas","count":3,"path":"api/tags/pandas.json"}],"author":{"name":"verfotta","slug":"blog-author","avatar":"/icons/favicon-32x32.png","link":"/","description":"您好","socials":{"github":"","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}}},"next_post":{}}